<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PairFX - Schaaktoernooi Manager</title>
    <link rel="stylesheet" href="css/styles.css?v=20251212m">
</head>
<body>
    <div id="app">
        <header>
            <h1>‚ôü PairFX</h1>
            <p class="subtitle">Mark Dechamps 2025 (c)</p>
        </header>

        <!-- Tournament Selection Screen -->
        <div id="tournament-selection-screen" class="screen">
            <div class="container">
                <h2>Selecteer of Cre√´er Toernooi</h2>

                <div class="action-buttons">
                    <button id="btn-new-tournament" class="btn btn-primary">+ Nieuw Toernooi</button>
                    <button id="btn-import-tournament" class="btn btn-secondary">üì• Importeer JSON</button>
                    <input type="file" id="file-import" accept=".json" style="display: none;">
                </div>

                <div id="tournament-list" class="tournament-list">
                    <!-- Tournaments will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Tournament Management Screen -->
        <div id="tournament-screen" class="screen" style="display: none;">
            <div class="tournament-header">
                <button id="btn-back" class="btn btn-secondary">‚Üê Terug</button>
                <h2 id="tournament-name">Toernooi</h2>
                <div class="tournament-actions">
                    <button id="btn-settings" class="btn btn-secondary">‚öôÔ∏è Instellingen</button>
                    <button id="btn-export" class="btn btn-secondary">üì§ Export JSON</button>
                    <button id="btn-export-standings" class="btn btn-secondary">üìä Export Klassement</button>
                </div>
            </div>

            <div class="three-column-layout">
                <!-- Left Column: Klassement & Player Management -->
                <div class="column column-left">
                    <div class="column-header">
                        <h3>Klassement</h3>
                        <button id="btn-add-player" class="btn btn-small btn-primary">+ Speler</button>
                    </div>
                    <div id="player-list" class="player-list">
                        <!-- Players will be rendered here -->
                    </div>
                </div>

                <!-- Middle Column: Available Players -->
                <div class="column column-middle">
                    <div class="column-header">
                        <h3>Beschikbare Spelers</h3>
                        <button id="btn-pair-selected" class="btn btn-primary">üé≤ Maak Paringen</button>
                    </div>
                    <div class="filter-section">
                        <input type="text" id="filter-available" placeholder="Filter op naam..." class="filter-input">
                    </div>
                    <div id="available-players-list" class="available-players-list">
                        <!-- Available players will be rendered here -->
                    </div>
                </div>

                <!-- Right Column: Pairings & Results -->
                <div class="column column-right">
                    <div class="column-header">
                        <h3>Paringen</h3>
                        <button id="btn-undo-last-batch" class="btn btn-small btn-warning">‚Ü∂ Ongedaan</button>
                    </div>
                    <div class="filter-section">
                        <input type="text" id="filter-pairings" placeholder="Filter op naam..." class="filter-input">
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter-active-only">
                            Enkel actieve partijen
                        </label>
                    </div>
                    <div id="pairings-list" class="pairings-list">
                        <!-- Pairings will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Toernooi Instellingen</h3>
                    <button class="modal-close" id="btn-close-settings">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Toernooi Naam</label>
                        <input type="text" id="setting-tournament-name" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Toernooi Type</label>
                        <select id="setting-tournament-type" class="form-input">
                            <option value="run-through">Run Through (Continue)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Klassement Basis</label>
                        <select id="setting-scoring-basis" class="form-input">
                            <option value="points">Punten</option>
                            <option value="percentage">Percentage</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Constraint X - Recente Tegenstander (rondes)</label>
                        <input type="number" id="setting-constraint-x" class="form-input" min="0" max="10" value="3">
                        <small>Spelers mogen niet tegen elkaar spelen in de laatste X rondes</small>
                    </div>
                    <div class="form-group">
                        <label>Constraint Y - Maximaal Puntenverschil</label>
                        <input type="number" id="setting-constraint-y" class="form-input" min="0" max="10" step="0.5" value="3">
                        <small>Maximaal puntenverschil tussen tegenstanders</small>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="setting-class-constraint">
                            Vermijd paringen binnen dezelfde klas (soft constraint)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-save-settings" class="btn btn-primary">Opslaan</button>
                    <button id="btn-cancel-settings" class="btn btn-secondary">Annuleren</button>
                </div>
            </div>
        </div>

        <!-- Player Edit Modal -->
        <div id="player-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="player-modal-title">Speler Toevoegen</h3>
                    <button class="modal-close" id="btn-close-player-modal">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Voornaam *</label>
                        <input type="text" id="player-voornaam" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Naam (optioneel)</label>
                        <input type="text" id="player-naam" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Klas (optioneel)</label>
                        <input type="text" id="player-klas" class="form-input">
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-save-player" class="btn btn-primary">Opslaan</button>
                    <button id="btn-cancel-player" class="btn btn-secondary">Annuleren</button>
                </div>
            </div>
        </div>

        <!-- Match History Modal -->
        <div id="history-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="history-modal-title">Partijgeschiedenis</h3>
                    <button class="modal-close" id="btn-close-history-modal">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="history-list" class="history-list">
                        <!-- Match history will be rendered here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-close-history" class="btn btn-secondary">Sluiten</button>
                </div>
            </div>
        </div>

        <!-- Copy Players Modal -->
        <div id="copy-players-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="copy-players-modal-title">Nieuw toernooi maken met spelers</h3>
                    <button id="btn-close-copy-players-modal" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="copy-tournament-name">Naam nieuw toernooi *</label>
                        <input type="text" id="copy-tournament-name" class="form-input" placeholder="Toernooi naam" required>
                    </div>

                    <div class="form-group">
                        <label>Selecteer spelers om te kopi√´ren</label>
                        <div style="margin-bottom: 10px;">
                            <button id="btn-select-all-players" class="btn btn-small btn-secondary">Alles selecteren</button>
                            <button id="btn-deselect-all-players" class="btn btn-small btn-secondary">Alles deselecteren</button>
                        </div>
                        <div id="copy-players-list" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--color-accent); border-radius: var(--border-radius); padding: var(--spacing-md);">
                            <!-- Players will be rendered here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-create-with-players" class="btn btn-primary">Maak Toernooi</button>
                    <button id="btn-cancel-copy-players" class="btn btn-secondary">Annuleren</button>
                </div>
            </div>
        </div>

        <!-- New Tournament Modal -->
        <div id="new-tournament-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nieuw Toernooi Aanmaken</h3>
                    <button id="btn-close-new-tournament-modal" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="new-tournament-name">Toernooi Naam *</label>
                        <input type="text" id="new-tournament-name" class="form-input" placeholder="Bijv. Schaakclub Najaar 2025" required autofocus>
                    </div>

                    <div class="form-group">
                        <label>Of importeer spelers direct uit CSV:</label>
                        <button id="btn-import-csv-new-tournament" class="btn btn-secondary btn-block">üì• Import CSV (Spelerslijst)</button>
                        <input type="file" id="file-import-players-new" accept=".csv,.txt" style="display: none;">

                        <!-- CSV Help -->
                        <div class="csv-help-container" style="margin-top: 8px; text-align: center;">
                            <small style="color: #999;">
                                Hoe moet mijn CSV eruit zien?
                                <button type="button" class="btn-icon-help" onclick="toggleCsvHelpModal()" title="CSV formaat uitleg" style="display: inline; padding: 2px 6px; margin-left: 4px;">‚ÑπÔ∏è</button>
                            </small>

                            <!-- CSV Help Popup -->
                            <div id="csvHelpContentModal" class="csv-help-popup" style="display: none;">
                                <div class="help-box">
                                    <h4>üìÑ CSV Formaat</h4>
                                    <p>Je CSV moet <strong>minimaal 1 kolom</strong> hebben:</p>
                                    <ol>
                                        <li><strong>Voornaam</strong> (verplicht)</li>
                                        <li><strong>Naam</strong> (optioneel)</li>
                                        <li><strong>Klas</strong> (optioneel)</li>
                                    </ol>

                                    <h4>üìù Voorbeeld:</h4>
                                    <pre class="csv-example">Voornaam,Naam,Klas
Jan,Peeters,5A
Marie,Janssens,5B
Tom,Wouters,5A
Lisa</pre>

                                    <div class="help-notes">
                                        <p>üí° <strong>Tips:</strong></p>
                                        <ul>
                                            <li>Naam is optioneel (alleen voornaam is verplicht)</li>
                                            <li>Duplicaten worden genegeerd</li>
                                            <li>Scheidingsteken: komma <code>,</code></li>
                                        </ul>
                                    </div>

                                    <button class="btn btn-small btn-secondary" onclick="downloadExampleCSV()">
                                        ‚¨áÔ∏è Download Voorbeeld
                                    </button>
                                    <button class="btn btn-small btn-secondary" onclick="toggleCsvHelpModal()">
                                        Sluiten
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-create-tournament" class="btn btn-primary">Maak Toernooi</button>
                    <button id="btn-cancel-new-tournament" class="btn btn-secondary">Annuleren</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load models first -->
    <script defer src="js/models/Player.js?v=20251212i"></script>
    <script defer src="js/models/Match.js?v=20251212"></script>
    <script defer src="js/models/Tournament.js?v=20251212i"></script>

    <!-- Then services -->
    <script defer src="js/services/StorageService.js?v=20251212d"></script>
    <script defer src="js/services/PairingService.js?v=20251212"></script>

    <!-- Then UI managers -->
    <script defer src="js/ui/TournamentManager.js?v=20251212n"></script>
    <script defer src="js/ui/PlayerManager.js?v=20251212i"></script>
    <script defer src="js/ui/PairingManager.js?v=20251212"></script>

    <!-- Finally the main app -->
    <script defer src="js/app.js?v=20251212m"></script>
</body>
</html>
